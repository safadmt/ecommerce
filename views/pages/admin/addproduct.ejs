

<!DOCTYPE html>
<html :class="{ 'theme-dark': dark }" x-data="data()" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Windmill Dashboard</title>
<style>
    .form-image-banner{
        width: 250px;
        object-fit: contain;
        aspect-ratio: 16/9;
    }
</style>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/admin/assets/css/tailwind.output.css" />
    <script
      src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
      defer
    ></script>
    <script src="/admin/assets/js/init-alpine.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"
      defer
    ></script>
    <script src="/admin/assets/js/charts-lines.js" defer></script>
    <script src="/admin/assets/js/charts-pie.js" defer></script>
  </head>
  <body>
    <div
      class="flex h-screen bg-gray-50 dark:bg-gray-900"
      :class="{ 'overflow-hidden': isSideMenuOpen }"
    >
      <%- include('../../partials/admin/adminasidebar.ejs') %>
      <div class="flex flex-col flex-1 w-full">
      <%- include('../../partials/admin/adminHeader.ejs') %>
      <main class="h-full pb-16 overflow-y-auto">
        <div class="container grid px-6 mx-auto">
<div class="add-product-main-div" style="background-color: #f5f5f5;">
  <div class="container">
    <h4 class="text-center">/ Admin/ products/ add-product</h4>
    <h4 class="text-center">Add new Watch</h4>
  </div>
  <div class="container">
    <a href="/admin/products/" class="btn btn-primary" style="margin-bottom: 10px;">Back</a>
  </div>
  
  <div class="container main-form-div">
    <form action="" class="add-product-form" onsubmit="handleSubmit(this)">
      <div class="row">
        <div class="col-md-6 col-sm-12">
          <label for="product_name">Name <span style="color: red; font-size: larger;">*</span></label>
          <input type="text" name="product_name" id="product_name" />
          
          <label for="brand">Brand <span style="color: red; font-size: larger;">*</span></label>
          <select name="brand" class="default-select" id="brand">
            <option value="">Select Brand</option>
            <option value="ROLEX">Rolex</option>
            <option value="FOSSIL">Fossil</option>
            <option value="TISSOT">Tissot</option>
            <option value="BOAT">Boat</option>
            <option value="GUESS">Guess</option>
            <option value="ARMANI EXCHANGE">Armani Exchange</option>
          </select>
          
          <label for="type">Type <span style="color: red; font-size: larger;">*</span></label>
          <select name="type" id="type">
            <option value="">Select</option>
            <option value="Analog">Analog</option>
            <option value="Analog-Digital">Analog-Digital</option>
            <option value="Digital">Digital</option>
            <option value="Hybrid Smart Watch">Hybrid Smart Watch</option>
          </select>
          
          <label for="price">Price <span style="color: red; font-size: larger;">*</span></label>
          <input type="number" name="price" id="price" />
        </div>
        <div class="col-md-6 col-sm-12">
          <label for="discount">Discount in percentage</label>
          <span id="discount-span"></span>
          <input type="number" name="discount_in_percentage" id="discount" />
          
          <label for="stock_available">Stock Available <span style="color: red; font-size: larger;">*</span></label>
          <input type="number" name="stock_available" id="stock_available" />
          
          <label for="isBlocked">Active or Inactive</label>
          <select name="isBlocked" id="isBlocked">
            <option value="">Select</option>
            <option value="true">True</option>
            <option value="false">False</option>
          </select>
          
          <label for="gender">Gender <span style="color: red; font-size: larger;">*</span></label>
          <select name="gender" id="gender">
            <option value="">Select</option>
            <option value="Mens">Mens</option>
            <option value="Womens">Womens</option>
            <option value="All">All</option>
          </select>
        </div>
        <div class="col-md-12">
          <label for="description">Description <span style="color: red; font-size: larger;">*</span></label>
          <textarea name="description" id="description" rows="4"></textarea>
          
          <label for="files">Upload Image <span style="color: red; font-size: larger;">*</span></label>
          <input type="file" name="files" id="files" multiple />
        </div>
      </div>
      <div class="button-div">
        <button type="submit" class="btn btn-primary">Add Product</button>
      </div>
    </form>
  </div>
</div>
        </div>
      </main>
      </div>
    </div>
  </body>
</html>
<script>
  function handleSubmit(formElement) {
    event.preventDefault();
    const files = document.getElementById('files').files;
    const obj = {};
    const formData = new FormData(formElement);
    for (const [name, value] of formData.entries()) {
      obj[name] = value;
    }
    
    const { price, product_name, stock_available, brand, description, isBlocked } = obj;
    
    if (!formData.get('product_name').trim()) {
      return showMessage("Name is required");
    }
    if (!formData.get('description').trim()) {
      return showMessage("Description is required");
    }
    if (!formData.get('brand')) {
      return showMessage("Brand is required");
    }
    if (!formData.get('type')) {
      return showMessage("Watch Type is required");
    }
    if (!formData.get('price')) {
      return showMessage("Price is required");
    }
    if (formData.get('discount_in_percentage')) {
      const discount = parseInt(formData.get('discount_in_percentage'));
      if (discount > 70) {
        return showMessage("Discount percentage not greater than 70%");
      }
    }
    if (!formData.get('stock_available')) {
      return showMessage("Stock available is required");
    }
    if (!formData.get('gender')) {
      return showMessage("Gender is required");
    }
    if (files.length === 0) {
      return showMessage("Image is required");
    }

    const xhttp = new XMLHttpRequest();
    xhttp.onload = function () {
      const response = JSON.parse(xhttp.response);
      console.log(response)
      if (response === "Ok") {
        const successdiv = document.createElement('div');
        successdiv.classList.add('successDiv');
        successdiv.classList.add('message');
        successdiv.textContent = "Product added successfully";
        const form = document.querySelector('.add-product-form');
        form.insertBefore(successdiv, form.firstChild);
        setTimeout(() => {
          window.location.reload();
        }, 2000);
      } else if (response.error) {
        return showMessage(response.error);
      }
    };
    xhttp.open('POST', 'http://localhost:5000/admin/products/add-product', true);
    xhttp.send(formData);
  }

  document.getElementById('discount').addEventListener('keydown', function (event) {
    const discountInput = document.getElementById('discount');
    const discount_span = document.getElementById('discount-span');
    if (discountInput.value.length >= 2) {
      discount_span.style.fontSize = "1.5rem";
      discount_span.style.color = "yellow";
      discount_span.textContent = "Only enter less than 70%";
    } else {
      discount_span.textContent = "";
    }
  });

  function showMessage(message) {
    const errorDiv = document.createElement('div');
    errorDiv.classList.add('errorDiv');
    errorDiv.classList.add('message');
    errorDiv.textContent = message;
    const form = document.querySelector('.main-form-div');
    form.insertBefore(errorDiv, form.firstChild);
    setTimeout(() => {
      errorDiv.remove();
    }, 4000);
  }
</script>
